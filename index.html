<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>Calculadora de Balanço Hídrico | Santa Casa Piracicaba</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style">
    <link rel="preload" href="static/css/healthcare-theme.css" as="style">
    
    <!-- Security Headers -->
    <meta http-equiv="Content-Security-Policy" content="
        default-src 'self';
        script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
        style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://fonts.googleapis.com;
        font-src 'self' https://cdn.jsdelivr.net https://fonts.gstatic.com;
        img-src 'self' data:;
        connect-src 'self';
        frame-ancestors 'none';
        base-uri 'self';
        form-action 'self';
    ">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Balanço Hídrico">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="static/img/favicon.svg">
    <link rel="icon" type="image/png" href="static/img/favicon.png">
    
    <!-- Fonts & Styles -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <link href="static/css/healthcare-theme.css" rel="stylesheet">
    
    <!-- SEO & Accessibility -->
    <meta name="description" content="Calculadora profissional de balanço hídrico para equipes médicas. Interface otimizada para dispositivos móveis e ambientes hospitalares.">
    <meta name="keywords" content="balanço hídrico, calculadora médica, UTI, pediatria, Santa Casa Piracicaba">
    <meta name="author" content="Santa Casa de Piracicaba">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Calculadora de Balanço Hídrico - Santa Casa Piracicaba">
    <meta property="og:description" content="Ferramenta profissional para cálculo de balanço hídrico em ambiente hospitalar">
    <meta property="og:type" content="website">
    <meta property="og:image" content="static/img/og-image.jpg">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen" aria-hidden="true">
        <div class="loading-spinner"></div>
        <p>Carregando calculadora...</p>
    </div>

    <!-- Skip Navigation -->
    <a href="#main-content" class="sr-only" tabindex="1">Pular para o conteúdo principal</a>

    <!-- Header -->
    <header class="healthcare-header" role="banner">
        <div class="healthcare-container">
            <a href="#" class="healthcare-logo" aria-label="Santa Casa Piracicaba - Página inicial">
                <i class="bi bi-heart-pulse-fill" aria-hidden="true"></i>
                <div>
                    <div>Calculadora de Balanço Hídrico</div>
                    <div class="healthcare-badge">Santa Casa Piracicaba</div>
                </div>
            </a>
            <div class="healthcare-status" id="connection-status" aria-live="polite">
                <span class="status-indicator online" aria-label="Status: Online"></span>
                <span class="status-text">Online</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" class="healthcare-container" role="main">
        
        <!-- Desktop Toolbar -->
        <div class="desktop-toolbar">
            <div class="toolbar-section">
                <span class="toolbar-label">Período:</span>
                <div class="period-selector-compact">
                    <label class="radio-compact">
                        <input type="radio" name="timeframe" value="12" id="period-12">
                        <span>12h</span>
                    </label>
                    <label class="radio-compact">
                        <input type="radio" name="timeframe" value="24" id="period-24" checked>
                        <span>24h</span>
                    </label>
                </div>
            </div>
            
            <div class="toolbar-section">
                <div class="progress-compact" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" aria-label="Progresso do preenchimento">
                    <div class="progress-bar-compact" id="progress-bar"></div>
                    <span class="progress-text-compact" id="progress-text">0% concluído</span>
                </div>
            </div>
            
            <div class="toolbar-section">
                <div class="button-group-desktop">
                    <button type="button" class="healthcare-button primary lg" onclick="calculateBalance()" id="calculate-button">
                        <i class="bi bi-calculator"></i>
                        <span>Calcular Balanço</span>
                        <kbd>Ctrl+Enter</kbd>
                    </button>
                    <button type="button" class="healthcare-button secondary" onclick="newPatient()">
                        <i class="bi bi-plus-circle"></i>
                        <span>Novo Paciente</span>
                        <kbd>Ctrl+N</kbd>
                    </button>
                </div>
            </div>
        </div>

        <!-- Desktop-First Form Layout -->
        <form class="healthcare-form" id="hydric-balance-form" novalidate>
            
            <!-- Desktop Form Grid -->
            <div class="desktop-form-layout">
                
                <!-- Column 1: Patient Information -->
                <div class="form-panel">
                    <div class="panel-header">
                        <h2 class="panel-title">
                            <i class="bi bi-person" aria-hidden="true"></i>
                            Dados do Paciente
                        </h2>
                    </div>
                    <div class="panel-content">
                        <div class="form-group">
                            <label for="patient-name" class="form-label required">Nome</label>
                            <input 
                                type="text" 
                                id="patient-name" 
                                class="form-control" 
                                placeholder="Nome completo do paciente"
                                required
                                autocomplete="name"
                                tabindex="1"
                            >
                        </div>
                        
                        <div class="input-group-desktop">
                            <div class="form-group">
                                <label for="patient-bed" class="form-label">Leito</label>
                                <input 
                                    type="text" 
                                    id="patient-bed" 
                                    class="form-control" 
                                    placeholder="Ex: UTI-05"
                                    tabindex="2"
                                >
                            </div>
                            <div class="form-group">
                                <label for="patient-weight" class="form-label required">Peso</label>
                                <div class="input-group-desktop">
                                    <input 
                                        type="number" 
                                        id="patient-weight" 
                                        class="form-control" 
                                        placeholder="0.0"
                                        step="0.1"
                                        min="0.1"
                                        max="300"
                                        required
                                        tabindex="3"
                                    >
                                    <span class="input-unit">kg</span>
                                </div>
                            </div>
                        </div>

                        <!-- Desktop Measurements Grid -->
                        <div class="measurements-section">
                            <h3 class="section-subtitle">Sinais Vitais</h3>
                            <div class="measurements-desktop-grid">
                                <div class="measurement-field">
                                    <label class="measurement-label">FC</label>
                                    <div class="input-group-desktop">
                                        <input type="text" id="heart-rate-input" class="form-control compact" placeholder="Ex: 80+90" tabindex="4">
                                        <button type="button" class="healthcare-button compact icon-only primary" onclick="addCalculationValue('heart-rate')" aria-label="Adicionar FC">
                                            <i class="bi bi-plus"></i>
                                        </button>
                                    </div>
                                    <div class="measurement-total" id="heart-rate-total">--</div>
                                    <input type="hidden" id="heart-rate" value="0">
                                </div>

                                <div class="measurement-field">
                                    <label class="measurement-label">FR</label>
                                    <div class="input-group-desktop">
                                        <input type="text" id="respiratory-rate-input" class="form-control compact" placeholder="Ex: 18+20" tabindex="5">
                                        <button type="button" class="healthcare-button compact icon-only primary" onclick="addCalculationValue('respiratory-rate')" aria-label="Adicionar FR">
                                            <i class="bi bi-plus"></i>
                                        </button>
                                    </div>
                                    <div class="measurement-total" id="respiratory-rate-total">--</div>
                                    <input type="hidden" id="respiratory-rate" value="0">
                                </div>

                                <div class="measurement-field">
                                    <label class="measurement-label">SatO₂</label>
                                    <div class="input-group-desktop">
                                        <input type="text" id="oxygen-saturation-input" class="form-control compact" placeholder="Ex: 98+97" tabindex="6">
                                        <button type="button" class="healthcare-button compact icon-only primary" onclick="addCalculationValue('oxygen-saturation')" aria-label="Adicionar SatO2">
                                            <i class="bi bi-plus"></i>
                                        </button>
                                    </div>
                                    <div class="measurement-total" id="oxygen-saturation-total">--</div>
                                    <input type="hidden" id="oxygen-saturation" value="0">
                                </div>

                                <div class="measurement-field">
                                    <label class="measurement-label">Temp</label>
                                    <div class="input-group-desktop">
                                        <input type="text" id="temperature-input" class="form-control compact" placeholder="Ex: 36,5+37,8" tabindex="7">
                                        <button type="button" class="healthcare-button compact icon-only primary" onclick="addCalculationValue('temperature')" aria-label="Adicionar Temp">
                                            <i class="bi bi-plus"></i>
                                        </button>
                                    </div>
                                    <div class="measurement-total" id="temperature-total">--</div>
                                    <input type="hidden" id="temperature" value="0">
                                </div>

                                <div class="measurement-field">
                                    <label class="measurement-label">PAM</label>
                                    <div class="input-group-desktop">
                                        <input type="text" id="blood-pressure-input" class="form-control compact" placeholder="Ex: 80+85" tabindex="8">
                                        <button type="button" class="healthcare-button compact icon-only primary" onclick="addCalculationValue('blood-pressure')" aria-label="Adicionar PAM">
                                            <i class="bi bi-plus"></i>
                                        </button>
                                    </div>
                                    <div class="measurement-total" id="blood-pressure-total">--</div>
                                    <input type="hidden" id="blood-pressure" value="0">
                                </div>

                                <div class="measurement-field">
                                    <label class="measurement-label">Glicemia</label>
                                    <div class="input-group-desktop">
                                        <input type="text" id="glucose-input" class="form-control compact" placeholder="Ex: 120+95" tabindex="9">
                                        <button type="button" class="healthcare-button compact icon-only primary" onclick="addCalculationValue('glucose')" aria-label="Adicionar Glicemia">
                                            <i class="bi bi-plus"></i>
                                        </button>
                                    </div>
                                    <div class="measurement-total" id="glucose-total">--</div>
                                    <input type="hidden" id="glucose" value="0">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Column 2: Values Input/Output -->
                <div class="values-section-desktop">
                    <div class="values-header-desktop">
                        <i class="bi bi-clipboard-data"></i>
                        <h2 class="values-title-desktop">Balanço Hídrico</h2>
                    </div>
                    
                    <div class="values-desktop-grid">
                        <!-- Inputs Section -->
                        <div>
                            <h3 class="section-subtitle" style="color: var(--medical-success);">
                                <i class="bi bi-arrow-down-circle"></i>
                                Entradas
                            </h3>
                            
                            <div class="calculation-field-desktop" data-field="diet">
                                <div class="calculation-label-desktop">
                                    <i class="bi bi-cup-straw"></i>
                                    Dieta (ml)
                                </div>
                                <div class="calculation-input-desktop">
                                    <input type="text" id="diet-input" class="form-control compact" placeholder="Ex: 150+50" tabindex="10">
                                    <button type="button" class="healthcare-button compact primary" onclick="addCalculationValue('diet')">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                    <button type="button" class="healthcare-button compact danger" onclick="clearCalculationField('diet')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                                <div class="calculation-list-desktop" id="diet-list"></div>
                                <div class="calculation-total-desktop" id="diet-total">Total: 0 ml</div>
                                <input type="hidden" id="diet" value="0">
                            </div>

                            <div class="calculation-field-desktop" data-field="serum">
                                <div class="calculation-label-desktop">
                                    <i class="bi bi-droplet-fill"></i>
                                    Soro (ml)
                                </div>
                                <div class="calculation-input-desktop">
                                    <input type="text" id="serum-input" class="form-control compact" placeholder="Ex: 500+200" tabindex="11">
                                    <button type="button" class="healthcare-button compact primary" onclick="addCalculationValue('serum')">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                    <button type="button" class="healthcare-button compact danger" onclick="clearCalculationField('serum')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                                <div class="calculation-list-desktop" id="serum-list"></div>
                                <div class="calculation-total-desktop" id="serum-total">Total: 0 ml</div>
                                <input type="hidden" id="serum" value="0">
                            </div>

                            <div class="calculation-field-desktop" data-field="medication">
                                <div class="calculation-label-desktop">
                                    <i class="bi bi-prescription2"></i>
                                    Medicação (ml)
                                </div>
                                <div class="calculation-input-desktop">
                                    <input type="text" id="medication-input" class="form-control compact" placeholder="Ex: 10+5" tabindex="12">
                                    <button type="button" class="healthcare-button compact primary" onclick="addCalculationValue('medication')">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                    <button type="button" class="healthcare-button compact danger" onclick="clearCalculationField('medication')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                                <div class="calculation-list-desktop" id="medication-list"></div>
                                <div class="calculation-total-desktop" id="medication-total">Total: 0 ml</div>
                                <input type="hidden" id="medication" value="0">
                            </div>
                        </div>

                        <!-- Outputs Section -->
                        <div>
                            <h3 class="section-subtitle" style="color: var(--medical-danger);">
                                <i class="bi bi-arrow-up-circle"></i>
                                Saídas
                            </h3>
                            
                            <div class="calculation-field-desktop" data-field="diuresis">
                                <div class="calculation-label-desktop">
                                    <i class="bi bi-droplet"></i>
                                    Diurese (ml)
                                </div>
                                <div class="calculation-input-desktop">
                                    <input type="text" id="diuresis-input" class="form-control compact" placeholder="Ex: 120+80" tabindex="13">
                                    <button type="button" class="healthcare-button compact primary" onclick="addCalculationValue('diuresis')">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                    <button type="button" class="healthcare-button compact danger" onclick="clearCalculationField('diuresis')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                                <div class="calculation-list-desktop" id="diuresis-list"></div>
                                <div class="calculation-total-desktop" id="diuresis-total">Total: 0 ml</div>
                                <input type="hidden" id="diuresis" value="0">
                            </div>

                            <div class="calculation-field-desktop" data-field="gastric-residue">
                                <div class="calculation-label-desktop">
                                    <i class="bi bi-circle-square"></i>
                                    Resíduo Gástrico (ml)
                                </div>
                                <div class="calculation-input-desktop">
                                    <input type="text" id="gastric-residue-input" class="form-control compact" placeholder="Ex: 30+20" tabindex="14">
                                    <button type="button" class="healthcare-button compact primary" onclick="addCalculationValue('gastric-residue')">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                    <button type="button" class="healthcare-button compact danger" onclick="clearCalculationField('gastric-residue')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                                <div class="calculation-list-desktop" id="gastric-residue-list"></div>
                                <div class="calculation-total-desktop" id="gastric-residue-total">Total: 0 ml</div>
                                <input type="hidden" id="gastric-residue" value="0">
                            </div>

                            <div class="calculation-field-desktop" data-field="emesis">
                                <div class="calculation-label-desktop">
                                    <i class="bi bi-exclamation-triangle"></i>
                                    Êmese (vezes)
                                </div>
                                <div class="calculation-input-desktop">
                                    <input type="text" id="emesis-input" class="form-control compact" placeholder="Ex: 2+1" tabindex="15">
                                    <button type="button" class="healthcare-button compact primary" onclick="addCalculationValue('emesis')">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                    <button type="button" class="healthcare-button compact danger" onclick="clearCalculationField('emesis')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                                <div class="calculation-list-desktop" id="emesis-list"></div>
                                <div class="calculation-total-desktop" id="emesis-total">Total: 0 vezes</div>
                                <input type="hidden" id="emesis" value="0">
                            </div>

                            <div class="calculation-field-desktop" data-field="evacuations">
                                <div class="calculation-label-desktop">
                                    <i class="bi bi-circle"></i>
                                    Evacuação (vezes)
                                </div>
                                <div class="calculation-input-desktop">
                                    <input type="text" id="evacuations-input" class="form-control compact" placeholder="Ex: 1+1" tabindex="16">
                                    <button type="button" class="healthcare-button compact primary" onclick="addCalculationValue('evacuations')">
                                        <i class="bi bi-plus"></i>
                                    </button>
                                    <button type="button" class="healthcare-button compact danger" onclick="clearCalculationField('evacuations')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                                <div class="calculation-list-desktop" id="evacuations-list"></div>
                                <div class="calculation-total-desktop" id="evacuations-total">Total: 0 vezes</div>
                                <input type="hidden" id="evacuations" value="0">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Column 3: Results Panel -->
                <div class="results-panel-desktop" id="results-container" style="display: none;">
                    <div class="results-header-desktop">
                        <h2 id="results-title">
                            <i class="bi bi-clipboard-data"></i>
                            Relatório de Balanço Hídrico
                        </h2>
                        <div class="button-group-desktop">
                            <button type="button" class="healthcare-button secondary compact" onclick="copyResults()" id="copy-button">
                                <i class="bi bi-clipboard"></i>
                                <span>Copiar</span>
                                <kbd>Ctrl+C</kbd>
                            </button>
                            <button type="button" class="healthcare-button secondary compact" onclick="printResults()">
                                <i class="bi bi-printer"></i>
                                <span>Imprimir</span>
                                <kbd>Ctrl+P</kbd>
                            </button>
                        </div>
                    </div>
                    <div class="results-content-desktop" id="results-content">
                        <!-- Results will be populated here -->
                    </div>
                </div>

            </div>
        </form>

    </main>

    <!-- Footer -->
    <footer class="healthcare-footer" role="contentinfo">
        <div class="healthcare-container">
            <p>&copy; 2024 Santa Casa de Piracicaba - Calculadora de Balanço Hídrico | v2.0</p>
            <p>
                <a href="#" class="footer-link">Política de Privacidade</a> |
                <a href="#" class="footer-link">Suporte Técnico</a> |
                <a href="security-test.html" class="footer-link">Testes de Segurança</a>
            </p>
        </div>
    </footer>

    <!-- Error Toast -->
    <div id="error-toast" class="toast error" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="bi bi-exclamation-triangle-fill" aria-hidden="true"></i>
            <strong>Erro</strong>
        </div>
        <div class="toast-body" id="error-message"></div>
    </div>

    <!-- Success Toast -->
    <div id="success-toast" class="toast success" role="alert" aria-live="polite" aria-atomic="true">
        <div class="toast-header">
            <i class="bi bi-check-circle-fill" aria-hidden="true"></i>
            <strong>Sucesso</strong>
        </div>
        <div class="toast-body" id="success-message"></div>
    </div>

    <!-- Scripts -->
    <script src="static/js/secure-math-parser.js"></script>
    <script src="static/js/calculator.js"></script>
    <script src="static/js/ui-manager.js"></script>
    <script src="static/js/form-handler.js"></script>
    <script src="static/js/healthcare-interface.js"></script>
    <script src="static/js/main.js"></script>
    
    <!-- PWA Service Worker -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => console.log('SW registered'))
                    .catch(registrationError => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>